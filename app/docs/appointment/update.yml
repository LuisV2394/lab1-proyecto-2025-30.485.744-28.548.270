tags:
  - Appointments
summary: Update appointment status
description: >
  Updates the status of an existing appointment.  
  Validates allowed state transitions and records history logs.  
  If the status change involves rescheduling (changing start/end), 
  the system must validate block availability and capacity again.
operationId: updateAppointmentStatus
consumes:
  - application/json
produces:
  - application/json

parameters:
  - name: id
    in: path
    required: true
    type: integer
    description: Appointment ID
    example: 44

  - in: body
    name: body
    required: true
    schema:
      type: object
      properties:
        status:
          type: string
          description: New appointment status
          enum: ["PENDING","CONFIRMED","IN_PROGRESS","COMPLETED","CANCELLED","RESCHEDULED","NO_SHOW"]
          example: "CONFIRMED"
        observations:
          type: string
          description: Additional notes about the status change
          example: "Paciente confirmó la asistencia"
        start:
          type: string
          format: date-time
          description: >
            Optional. Only used when rescheduling.  
            Requires revalidation of availability and block capacity.
          example: "2025-01-15T14:00:00"
        end:
          type: string
          format: date-time
          description: >
            Optional. Only used when rescheduling.
          example: "2025-01-15T15:00:00"

responses:
  200:
    description: Appointment status updated successfully
    schema:
      type: object
      properties:
        message:
          type: string
          example: "Estado actualizado"
        status:
          type: string
          example: "CONFIRMED"

  400:
    description: Invalid status transition or invalid input
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Transición inválida de PENDING a COMPLETED"

  404:
    description: Appointment not found
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Cita no encontrada"

  500:
    description: Server error
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Error interno del servidor"