tags:
  - Appointments
summary: Update appointment status
description: >
  Updates the status of an existing appointment.  
  Validates allowed state transitions and records history logs.  
  Rescheduling (changing start/end) is handled as a normal update 
  without block availability validation, since blocks no longer exist.
operationId: updateAppointmentStatus
consumes:
  - application/json
produces:
  - application/json

parameters:
  - name: id
    in: path
    required: true
    type: integer
    description: Appointment ID
    example: 44

  - in: body
    name: body
    required: true
    schema:
      type: object
      properties:
        status:
          type: string
          description: New appointment status
          enum: ["SOLICITADA","CONFIRMADA","CUMPLIDA","CANCELADA","NO_ASISTIDA"]
          example: "CONFIRMADA"
        observations:
          type: string
          description: Additional notes about the status change
          example: "Paciente confirmó la asistencia"
        start:
          type: string
          format: date-time
          description: Optional. New start time if rescheduling.
          example: "2025-01-15T14:00:00"
        end:
          type: string
          format: date-time
          description: Optional. New end time if rescheduling.
          example: "2025-01-15T15:00:00"

responses:
  200:
    description: Appointment status updated successfully
    schema:
      type: object
      properties:
        message:
          type: string
          example: "Estado actualizado"
        status:
          type: string
          example: "CONFIRMADA"

  400:
    description: Invalid status transition or invalid input
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Transición inválida de SOLICITADA a CUMPLIDA"

  404:
    description: Appointment not found
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Cita no encontrada"

  500:
    description: Server error
    schema:
      type: object
      properties:
        error:
          type: string
          example: "Error interno del servidor"